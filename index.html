<html>
<head>
    <title>My first Three.js app</title>
    <style>
        body{
            margin:0;
        }
        canvas {
        width: 100%;
        height: 100%
    }</style>
</head>
<body>
<script src="js/lib/three.min.js"></script>
<script src="js/lib/loaders/MTLLoader.js"></script>
<script src="js/lib/loaders/OBJLoader.js"></script>
<script src="js/lib/loaders/OBJMTLLoader.js"></script>
<script>


    var scene = new THREE.Scene();
    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    var ambientLight = new THREE.AmbientLight(0xffffff);
    scene.add(ambientLight);
    var directionalLight = new THREE.DirectionalLight(0xffffff);
    directionalLight.position.set(1, 1, 1).normalize();
    scene.add(directionalLight);

    //Load Ship
    var loader = new THREE.OBJMTLLoader();
    var ship;
    loader.load("assets/ships/test/Sample_Ship.obj",function (object) {
        ship =  object;
        scene.add(ship);
        camera.position.y += 200;
        ship.add(camera);
        camera.position.z -= 600;
        camera.lookAt(ship.position);

    });

    //Load Skybox
    var imagePrefix = "assets/sky/sky1/";
    var directions  = ["posx", "negx", "posy", "negy", "posz", "negz"];
    var imageSuffix = ".png";
    var materialArray = [];
        directions.forEach(function(name){
            materialArray.push(imagePrefix+name+imageSuffix);
        });
    var cubemap = THREE.ImageUtils.loadTextureCube(materialArray); // load textures
    cubemap.format = THREE.RGBFormat;
    var shader = THREE.ShaderLib['cube']; // init cube shader from built-in lib
    shader.uniforms['tCube'].value = cubemap; // apply textures to shader

    // create shader material
    var skyBoxMaterial = new THREE.ShaderMaterial( {
      fragmentShader: shader.fragmentShader,
      vertexShader: shader.vertexShader,
      uniforms: shader.uniforms,
      depthWrite: false,
      side: THREE.DoubleSide
    });

    // create skybox mesh
    var skybox = new THREE.Mesh(
      new THREE.CubeGeometry(100000, 100000, 100000),
      skyBoxMaterial
    );
    scene.add(skybox);


    //Render Loop
    var clock = new THREE.Clock();
    var render = function (now) {
        requestAnimationFrame(render);
        var delta = clock.getDelta();
        if(ship!=undefined){
            ship.rotation.y += 10 * delta * Math.PI / 180;
            ship.rotation.x += 10 * delta * Math.PI / 180;
            skybox.position=camera.position;
        }
        last = now;
        renderer.render(scene, camera);
    };
    window.addEventListener('resize', onWindowResize, false);


    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);

    }
    requestAnimationFrame(render);
</script>
</body>
</html>